<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Scam Call Monitor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="/static/favicon.ico" sizes="any" />
    <link rel="stylesheet" href="/static/css/matrix.css" />
    <style>
      body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background: #0b1820; color: #d4f1f9; }
      header { display: flex; align-items: center; justify-content: space-between; padding: 16px 24px; border-bottom: 1px solid rgba(255,255,255,0.06); }
      header .title { font-weight: 600; }
      header nav a { color: #87f7cf; margin-left: 16px; text-decoration: none; }
      main { padding: 24px; }
      .panel { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.07); border-radius: 12px; padding: 24px; }
      .hidden { display: none; }
      .status-dot { width: 10px; height: 10px; border-radius: 50%; background: #1a3; box-shadow: 0 0 8px #1a3; }
      .status-dot.idle { background: #444; box-shadow: none; }
      .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
      .countdown { display: flex; align-items: center; gap: 24px; }
      .ring { width: 200px; height: 200px; position: relative; }
      .ring svg { transform: rotate(-90deg); }
      .ring .label { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; flex-direction: column; color: #e8fffb; }
      .ring .label .time { font-size: 44px; font-weight: 800; letter-spacing: 1px; }
      .ring .label .sub { margin-top: 8px; opacity: 0.8; }
      .meta { display: grid; grid-template-columns: auto auto; gap: 8px 12px; }
      .button { padding: 10px 16px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.15); background: #0f2a29; color: #9ff3d7; cursor: pointer; }
      .button.primary { background: #14b89a; color: #04221f; border: none; }
      .button[disabled] { opacity: 0.6; cursor: not-allowed; }
      .conversation { height: 420px; overflow: auto; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.06); border-radius: 12px; padding: 16px; }
      .message { display: grid; grid-template-columns: 120px 1fr; gap: 8px; padding: 6px 0; border-bottom: 1px dashed rgba(255,255,255,0.06); }
      .message .role.assistant { color: #87f7cf; font-weight: 700; }
      .message .role.callee { color: #d6c3ff; font-weight: 700; }
      footer { margin-top: 16px; opacity: 0.7; font-size: 12px; }
      .caps { font-variant-numeric: tabular-nums; }
      .inline { display: inline-flex; align-items: center; gap: 8px; }
    </style>
  </head>
  <body data-page="scamcalls">
    <header>
      <div class="title">Scam Call Monitor</div>
      <nav>
        <a href="/scamcalls" aria-current="page">Live</a>
        <a href="/scamcalls/history">History</a>
        <button id="adminBtn" class="button" type="button">Admin</button>
      </nav>
    </header>

    <main>
      <div class="panel">
        <div style="display:flex; align-items:center; justify-content: space-between; margin-bottom: 12px;">
          <div style="display:flex; align-items:center; gap:8px;">
            <div style="font-weight:700;">Next Outbound Call</div>
            <span id="statusDot" class="status-dot idle"></span>
          </div>
          <div class="meta">
            <div>Destination</div><div id="destNumber">—</div>
            <div>From</div><div id="fromNumber">—</div>
            <div>Window</div><div id="activeWindow">—</div>
            <div>Caps</div><div id="caps" class="caps">—</div>
          </div>
        </div>

        <div class="grid">
          <!-- Countdown panel -->
          <div id="countdownPanel">
            <div class="countdown">
              <div class="ring">
                <svg viewBox="0 0 120 120" width="200" height="200" aria-hidden="true">
                  <circle cx="60" cy="60" r="54" stroke="rgba(255,255,255,0.08)" stroke-width="12" fill="none"></circle>
                  <circle class="ring-progress" cx="60" cy="60" r="54" stroke="#1ef7c5" stroke-width="12" fill="none" stroke-linecap="round"></circle>
                </svg>
                <div class="label">
                  <div class="time"><span id="cdMinutes">--</span>:<span id="cdSeconds">--</span></div>
                  <div class="sub" id="cdSubtitle">Until next call attempt</div>
                </div>
              </div>
              <div style="display:flex; flex-direction:column; gap:8px;">
                <button id="callNowBtn" class="button primary" type="button">Call now</button>
                <button id="greetingBtn" class="button" type="button">Add greeting phrase</button>
                <div style="font-size: 12px; opacity: 0.8;">Served via: <span id="publicUrl">auto</span></div>
              </div>
            </div>
          </div>

          <!-- Active call panel -->
          <div id="callPanel" class="hidden">
            <div style="display:flex; align-items:center; gap:12px; margin-bottom:8px; justify-content: space-between;">
              <div class="inline">
                <div style="font-weight:700;">Active Call</div>
                <span id="callStatusBadge" class="button">Connected</span>
                <div>SID: <span id="callSid">—</span></div>
              </div>
              <div class="inline">
                <button id="listenBtn" class="button" type="button" title="Play live audio">Listen Live</button>
              </div>
            </div>
            <div id="conversation" class="conversation"></div>
          </div>
        </div>

        <footer>
          <div id="appStatus">Status: Initializing...</div>
        </footer>
      </div>
    </main>

    <script src="/static/js/matrix.js"></script>
    <script src="/static/scamcalls.js"></script>
  </body>
</html>
